<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The World of Draelon – Campaign Primer (v63a)</title>
  <style>
    :root{
      --paper:#fbf3dd; --paper-2:#f6edd1; --ink:#2c2416; --ink-soft:#5c523f;
      --accent:#8b5e34; --rule:#d8caa6; --edge:#cbb98f; --shadow:0 18px 40px rgba(0,0,0,.25);
      --radius:16px;
      --wrap-wide: min(96vw, 1900px);
      --wrap-mobile: min(92vw, 900px);
      --ivory:#f6e7c8;
      --btn:#ead8aa; --btn2:#dfc98a;
    }
    html,body{height:100%}
    body{
      margin:0; color:var(--ink);
      background:#fff8da; /* solid parchment, no seams */
      font-family: Georgia, "Iowan Old Style", "Palatino Linotype", serif;
      line-height:1.45;
      -webkit-tap-highlight-color: transparent;
    }
    *{ user-select: none; -webkit-user-select: none; -ms-user-select: none; }
    input, textarea, select, .island-lore, .side .content{ user-select: text; -webkit-user-select: text; }

    /* Fantasy title */
    .title-wrap{display:flex; justify-content:center; margin: 18px 12px 0;}
    .page-title{
      max-width: var(--wrap-wide);
      width:100%;
      text-align:center;
      font-variant: small-caps;
      font-weight: 800;
      letter-spacing: 2px;
      font-size: clamp(28px, 6vw, 64px);
      color: #3b2b15;
      margin: 8px auto 0;
      padding: 10px 8px 6px;
      position: relative;
      background:
        linear-gradient(180deg, rgba(139,94,52,.12), rgba(139,94,52,0)),
        radial-gradient(120% 120% at 50% 0%, rgba(255,255,255,.35), rgba(255,255,255,0) 60%);
      border-radius: 14px;
      white-space: nowrap;
    }
    .page-title .sub{
      display:block; font-size: clamp(12px, 2vw, 16px); letter-spacing: 3px; color: #6a5841;
      margin-top: 2px; white-space: normal;
    }
    .page-title .glyph{
      display:inline-block; width: clamp(22px, 2.8vw, 34px); height: clamp(22px, 2.8vw, 34px);
      border-radius:50%; margin: 0 10px; vertical-align: -4px;
      background:
        radial-gradient(circle at 50% 50%, rgba(139,94,52,.18), rgba(139,94,52,0) 60%),
        conic-gradient(from 0deg, rgba(139,94,52,.7), rgba(139,94,52,.15), rgba(139,94,52,.7));
      border:1px solid rgba(139,94,52,.45);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.35);
    }
    @media (max-width: 560px){
      .page-title{ letter-spacing: 1px; font-size: clamp(26px, 7.2vw, 56px); padding: 8px 6px 4px; }
      .page-title .glyph{ display:none; }
    }

    /* Generic panels */
    .panel{
      background: linear-gradient(180deg, var(--paper), var(--paper-2));
      border: 1px solid var(--edge);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:relative;
    }
    .panel::after{
      content:""; position:absolute; inset:0; pointer-events:none; border-radius: var(--radius);
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.04), inset 0 30px 60px rgba(0,0,0,.06);
    }

    /* Map area */
    .map-row{display:flex; justify-content:center; margin-top:12px;}
    .map-wrap{
      position:relative;
      width:100%;
      max-width: var(--wrap-wide);
      min-height: 64vh;
      max-height: 86vh;
      margin: 0 12px;
      overflow:hidden;
      border-radius: 22px;
    }
    .map-wrap.ornate{
      background:
        radial-gradient(140% 120% at 50% 0%, rgba(255,255,255,.20), rgba(0,0,0,0) 60%),
        linear-gradient(180deg, var(--paper-2), var(--paper));
      border: 1px solid var(--edge);
      box-shadow:
        0 20px 40px rgba(0,0,0,.25),
        inset 0 0 0 2px rgba(139,94,52,.15),
        inset 0 0 60px rgba(139,94,52,.10);
    }
    .map-wrap svg{
      width:100%; height:100%; display:block;
      background:#efe6c8;
      touch-action:none; cursor:grab;
      border-radius: 18px;
    }

    /* Zoom controls */
    .zoom-ctrl{
      position:absolute; right:14px; bottom:14px; z-index:45;
      display:flex; flex-direction:column; gap:8px;
      background: rgba(255,255,255,.7);
      border:1px solid var(--edge); border-radius:12px; padding:8px;
      backdrop-filter: blur(2px);
      box-shadow: var(--shadow);
    }
    .zoom-ctrl button{
      font-size:18px; line-height:1; width:40px; height:40px;
      border-radius:10px; border:1px solid var(--edge);
      background: linear-gradient(180deg, #f7edcf, #efe2b6);
      cursor:pointer;
    }
    .zoom-ctrl button:active{ transform: translateY(1px); }

    .loader{position:absolute;left:10px;top:10px;display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.75);border:1px solid var(--edge);border-radius:10px;padding:6px 10px;z-index:20;backdrop-filter:blur(2px)}
    .spinner{width:14px;height:14px;border-radius:50%;border:2px solid rgba(0,0,0,.2); border-top-color:var(--accent); animation:spin .8s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .gm-btn{position:absolute;top:12px;right:72px;z-index:46;background:linear-gradient(180deg, #f7edcf, #efe2b6);color:var(--ink);border:1px solid var(--edge);border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer;box-shadow: var(--shadow)}
    .gm-btn.on{background:linear-gradient(180deg, #e7d69e, #e0c87e);}

    /* Features */
    .feature{cursor:pointer}
    .feature.point circle{stroke:var(--paper);stroke-width:3;fill:var(--accent)}
    .feature.point .label{font-size:36px;fill:var(--ink);pointer-events:none;paint-order:stroke;stroke:#faedcf;stroke-width:6px;stroke-linejoin:round}
    .feature.region path.fill{transition:fill-opacity .12s linear; pointer-events:auto}
    .feature.region.hover path.fill{fill-opacity:.48}
    .feature.region.selected path.fill{fill-opacity:.56}

    .feature.region .ol-glow,
    .feature.region .ol-mid,
    .feature.region .ol-core{
      fill:none; stroke-linejoin:round; stroke-linecap:round;
      opacity:0; pointer-events:none; transition: opacity .12s linear;
    }
    .feature.region .ol-glow{ stroke-width:14; filter:url(#neonOuter); }
    .feature.region .ol-mid { stroke-width:8;  filter:url(#neonInner); }
    .feature.region .ol-core{ stroke:var(--ivory); stroke-width:2.5; }
    .feature.region.hover .ol-glow,
    .feature.region.hover .ol-mid,
    .feature.region.hover .ol-core{ opacity:.70; }
    .feature.region.selected .ol-glow,
    .feature.region.selected .ol-mid,
    .feature.region.selected .ol-core{ opacity:.90; }

    /* Tooltip */
    .tooltip{
      position:absolute;min-width:260px;max-width:520px;background:var(--paper);
      border:1px solid var(--edge);border-radius:12px;box-shadow: var(--shadow);
      z-index:1000;display:none;pointer-events:auto;overflow:auto;
    }
    .tooltip.open{display:block}
    .tooltip header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--rule); background:linear-gradient(180deg,var(--paper),var(--paper-2)); position:sticky; top:0; z-index:2}
    .tooltip header h3{margin:0;font-size:16px}
    .tooltip .close{background:transparent;border:0;color:var(--ink);cursor:pointer;font-size:18px}
    .tooltip .media{width:100%;overflow:hidden;background:#e6d9b6;border-bottom:1px solid var(--rule)}
    .tooltip .media img{width:100%;height:auto;display:block}
    .tooltip .body{padding:10px 12px;line-height:1.5;}
    .tooltip .body p{margin:0}

    /* Mobile-only side panel for tooltips */
    .side-row{display:flex; justify-content:center}
    .side{
      width:100%;
      max-width: var(--wrap-mobile);
      display:flex;flex-direction:column;
      margin:12px; overflow:hidden;
    }
    .side header{padding:14px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:2px solid var(--rule);background:linear-gradient(180deg,var(--paper),var(--paper-2));border-top-left-radius:var(--radius);border-top-right-radius:var(--radius)}
    .side header h1{font-size:18px;margin:0;letter-spacing:.6px;text-transform:uppercase}
    .side .content{padding:16px;overflow:visible}
    .lore-title{font-weight:700;margin:0 0 8px;font-size:20px;letter-spacing:.2px}
    .lore-body{line-height:1.6;}
    .lore-media{margin:0 0 12px 0; display:none}
    .lore-media img{width:100%; height:auto; display:block; border-radius:10px; border:1px solid var(--edge); box-shadow: var(--shadow)}

    /* Ornate horizontal rule */
    .ornate-rule{
      display:flex; align-items:center; justify-content:center;
      gap:14px; margin: 18px auto; width:100%;
      max-width: var(--wrap-wide);
    }
    .ornate-rule .line{
      height:0; border:0; border-top:1px solid rgba(139,94,52,.45);
      box-shadow: 0 -1px 0 rgba(255,255,255,.3) inset;
      flex:1;
    }
    .ornate-rule .glyph{
      width:34px; height:34px; border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, rgba(139,94,52,.18), rgba(139,94,52,0) 60%),
        conic-gradient(from 0deg, rgba(139,94,52,.7), rgba(139,94,52,.15), rgba(139,94,52,.7));
      border:1px solid rgba(139,94,52,.45);
      box-shadow: var(--shadow), inset 0 0 0 2px rgba(255,255,255,.35);
    }

    /* Island section */
    .section{margin:8px 16px 16px 16px; display:flex; justify-content:center;}
    .island-grid{
      display:grid; grid-template-columns: 1fr 1fr; gap:16px;
      align-items:start; max-width:var(--wrap-wide); width:100%;
    }
    .island-card{ margin:0; padding:12px; background:linear-gradient(180deg, var(--paper), var(--paper-2));
      border:1px solid var(--edge); border-radius: var(--radius); box-shadow: var(--shadow);
      display:block; max-width:100%; }
    .island-card img{display:block; width:100%; height:auto}
    .island-lore{padding:16px}
    .island-lore h3{margin:0 0 8px 0;font-size:18px;text-transform:uppercase;letter-spacing:.4px}
    .island-lore .body{line-height:1.6}

    /* GM overlay */
    .gm-bar{
      position:absolute; left:12px; top:12px; z-index:45;
      background:linear-gradient(180deg, #fff7dd, #f2e5b7);
      border:1px solid var(--edge); border-radius:12px; padding:8px; display:none; gap:6px; align-items:center;
      box-shadow: var(--shadow);
    }
    body.gm-on .gm-bar{ display:flex; }
    .gm-bar .row{ display:flex; gap:6px; flex-wrap:wrap; align-items:center }

    .gm-bar label{ font-size:12px; color:var(--ink-soft) }
    .gm-bar input[type="text"], .gm-bar input[type="color"], .gm-bar select{
      font-size:12px; padding:4px 6px; border:1px solid var(--edge); border-radius:6px; background:#fffaf0;
    }
    .gm-bar button{
      font-size:12px; padding:6px 10px; border:1px solid var(--edge); border-radius:999px; cursor:pointer;
      background:linear-gradient(180deg, var(--btn), var(--btn2));
    }
    .gm-bar .sep{ width:1px; height:20px; background:var(--edge); margin:0 4px; }

    .gm-overlay .shape-path{ fill:rgba(255,255,240,.25); stroke:#8b5e34; stroke-width:2; }
    .gm-overlay .handle{ fill:#fff; stroke:#8b5e34; stroke-width:2; cursor:grab; }
    .gm-overlay .handle.drag{ cursor:grabbing; }
    .gm-overlay .edge{ stroke:rgba(139,94,52,.5); stroke-width:8; stroke-linecap:round; opacity:.0001; cursor:copy; }
    .gm-overlay .handle.del{ fill:#8b3434; stroke:#fff; }

    body.gm-on [contenteditable="true"]{
      outline: 2px dashed rgba(139,94,52,.45);
      background: linear-gradient(180deg, rgba(255,255,240,.35), rgba(255,255,220,.25));
      border-radius: 8px; padding: 6px; transition: background .2s ease;
    }
    body.gm-on [contenteditable="true"]:focus{
      background: linear-gradient(180deg, rgba(255,255,230,.6), rgba(255,255,210,.45));
    }

    /* Responsive */
    @media (max-width: 760px){
      .map-wrap{ max-width: var(--wrap-mobile); min-height: min(60vh, calc(100vw * 0.72)); max-height:none; }
      .tooltip{ display:none !important; }
      .side-row{ display:flex; }
      .ornate-rule{ max-width: var(--wrap-mobile); }
      .island-grid{ grid-template-columns: 1fr !important; grid-auto-flow: row !important; max-width: var(--wrap-mobile); }
      .island-card{ order: 1 !important; }
      .island-lore{ order: 2 !important; margin-top: 12px !important; }
    }
    @media (min-width: 761px){
      .side-row{ display:none; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="title-wrap">
      <h1 class="page-title">The <span class="glyph"></span> World of Draelon <span class="glyph"></span><span class="sub">Campaign Primer</span></h1>
    </div>

    <div class="map-row">
      <div class="map-wrap ornate" id="mapWrap">
        <div class="loader" id="loader" aria-live="polite"><div class="spinner"></div><span id="loaderText">Loading world…</span></div>
        <button class="gm-btn" id="gmBtn" title="GM Mode" type="button">GM</button>
        <div class="zoom-ctrl" aria-label="Map zoom controls">
          <button id="zoomIn" title="Zoom in">＋</button>
          <button id="zoomOut" title="Zoom out">－</button>
        </div>

        <div class="gm-bar" id="gmBar">
          <div class="row">
            <select id="regionSelect"></select>
            <button id="newRegionBtn" title="Create new region">+ Region</button>
            <span class="sep"></span>
            <label>Name</label><input id="regionName" type="text" size="12" />
            <label>Color</label><input id="regionColor" type="color" value="#8ad9ff" />
            <span class="sep"></span>
            <button id="addShapeBtn" title="Start a new polygon for this region">+ Shape</button>
            <button id="finishShapeBtn" title="Finish current shape">Finish</button>
            <button id="addVertexModeBtn" title="Click an edge to insert a vertex">Add Vertex</button>
            <button id="delVertexModeBtn" title="Click a vertex to delete it">Del Vertex</button>
            <span class="sep"></span>
            <button id="saveJsonBtn" title="Download world-data.json">Save JSON</button>
          </div>
        </div>

        <div class="tooltip" id="tooltip" role="dialog" aria-live="polite">
          <div class="media" id="ttMedia" style="display:none"><img id="ttImg" alt=""></div>
          <header>
            <h3 id="ttTitle">Title</h3>
            <button class="close" id="ttClose" aria-label="Close">×</button>
          </header>
          <div class="body" id="ttBody"></div>
        </div>

        <svg id="world" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet" aria-label="Interactive world map">
          <defs>
            <filter id="fuzzyEdge" x="-4%" y="-4%" width="108%">
              <feGaussianBlur in="SourceAlpha" stdDeviation="2.5" result="blur" />
              <feComposite in="SourceGraphic" in2="blur" operator="in" />
            </filter>
            <filter id="neonOuter" x="-30%" y="-30%" width="160%" height="160%">
              <feGaussianBlur stdDeviation="4" result="blur1"/>
              <feMerge><feMergeNode in="blur1"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
            <filter id="neonInner" x="-12%" y="-12%" width="124%" height="124%">
              <feGaussianBlur stdDeviation="1.5" result="blur3"/>
              <feMerge><feMergeNode in="blur3"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <image id="mapImage" href="" x="0" y="0" width="1000" height="600" preserveAspectRatio="none" />
          <g id="regions"></g>
          <g id="points"></g>
          <g id="gmOverlay" class="gm-overlay"></g>
        </svg>
      </div>
    </div>

    <!-- Mobile-only panel for tooltip content -->
    <div class="side-row">
      <aside class="side panel" id="sidePanel">
        <header><h1>Campaign Info</h1><span class="muted">Tap the map to explore</span></header>
        <div class="content">
          <div class="lore-media" id="loreMedia"><img id="loreImg" alt=""></div>
          <h3 class="lore-title" id="loreTitle">Welcome</h3>
          <div class="lore-body" id="loreBody">Use the map to learn about regions like <b>Oscana</b>, <b>Athium</b>, <b>Eturia</b>, and the island of <b>Signika</b>.</div>
        </div>
      </aside>
    </div>

    <div class="ornate-rule" aria-hidden="true">
      <span class="line"></span><span class="glyph"></span><span class="line"></span>
    </div>
  </div>

  <section class="section">
    <div class="island-grid">
      <figure class="island-card"><img id="islandImg" src="" alt="Signika island map"/></figure>
      <div class="island-lore panel"><h3>Island Lore</h3><div id="islandLore" class="body">Add your Signika lore here — history, factions, features, and travel notes.</div></div>
    </div>
  </section>




<script>
document.addEventListener('DOMContentLoaded', () => {
  const loreElement = document.getElementById('islandLore');
  if (loreElement && loreElement.textContent.includes('\n')) {
    const text = loreElement.textContent;
    const formatted = text.split(/\n\n/).map(p => `<p>${p}</p>`).join('');
    loreElement.innerHTML = formatted;
  }
});
</script>

</body>
</html>
